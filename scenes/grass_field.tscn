[gd_scene load_steps=15 format=3 uid="uid://p7360b8bsbyr"]

[ext_resource type="PlaneMesh" uid="uid://b28ffsg2x4ipw" path="res://assets/materials/grass_mesh.tres" id="1_fa7tb"]
[ext_resource type="Script" uid="uid://e348oofdfnyq" path="res://assets/scripts/multi_mesh_grass.gd" id="2_qwphb"]
[ext_resource type="Shader" uid="uid://cpx8hypdq3fwh" path="res://assets/shaders/grass_blade_debug.gdshader" id="3_t2h0i"]
[ext_resource type="Material" uid="uid://bc01ru1635u3y" path="res://assets/materials/brown_mud_leaves_01.res" id="4_awlud"]
[ext_resource type="Shader" uid="uid://xde23rj60lyr" path="res://assets/shaders/square.gdshader" id="5_kluv6"]

[sub_resource type="MultiMesh" id="MultiMesh_6hef4"]
transform_format = 1
instance_count = 1
mesh = ExtResource("1_fa7tb")
buffer = PackedFloat32Array(-0.219459, 0, 1.26286, -24.8607, 0, 1.28179, 0, 0, -1.26286, 0, -0.219459, -17.1059)

[sub_resource type="FastNoiseLite" id="FastNoiseLite_jv7tp"]
noise_type = 3
seed = 1

[sub_resource type="NoiseTexture2D" id="NoiseTexture2D_4uy1i"]
seamless = true
noise = SubResource("FastNoiseLite_jv7tp")

[sub_resource type="ShaderMaterial" id="ShaderMaterial_bstpt"]
render_priority = 0
shader = ExtResource("3_t2h0i")
shader_parameter/control_x = 0.25
shader_parameter/control_y = 0.75
shader_parameter/base_width = 0.7
shader_parameter/middle_width = 0.135
shader_parameter/side_thickness = 1.0
shader_parameter/base_color = Color(1, 0.314561, 0.0920392, 1)
shader_parameter/details_effect_strength = 0.1
shader_parameter/ridge_smoothness = 0.03
shader_parameter/rim_thickness = 0.49
shader_parameter/rim_smoothness = 0.1
shader_parameter/wind_texture = SubResource("NoiseTexture2D_4uy1i")
shader_parameter/wind_tex_scale = 75.0
shader_parameter/wind_direction_randomness = 1.5
shader_parameter/wind_texture_speed_x = -0.2
shader_parameter/wind_texture_speed_y = -0.04
shader_parameter/wind_texture_speed = 0.4
shader_parameter/grass_swell_amplitude = 0.5
shader_parameter/flutter_frequency = 2.0
shader_parameter/flutter_speed = 0.5
shader_parameter/flutter_amplitude = 0.03
shader_parameter/wind_effect_base_amplitude = 0.4
shader_parameter/wind_effect_mid_amplitude = 1.6
shader_parameter/wind_effect_tip_amplitude = 1.0
shader_parameter/wind_pivot_amplitude = 0.6

[sub_resource type="PlaneMesh" id="PlaneMesh_w5gws"]
material = ExtResource("4_awlud")
size = Vector2(500, 500)

[sub_resource type="PlaneMesh" id="PlaneMesh_an6go"]
size = Vector2(50, 50)

[sub_resource type="ConcavePolygonShape3D" id="ConcavePolygonShape3D_an6go"]
data = PackedVector3Array(10, 0, 10, -10, 0, 10, 10, 0, -10, -10, 0, 10, -10, 0, -10, 10, 0, -10)

[sub_resource type="ShaderMaterial" id="ShaderMaterial_shj6h"]
render_priority = 0
shader = ExtResource("5_kluv6")
shader_parameter/control_x = 0.65
shader_parameter/control_y = 0.5
shader_parameter/base_width = 1.0
shader_parameter/middle_width = 1.0
shader_parameter/base_color = Color(0, 0, 0, 1)
shader_parameter/ridge_smoothness = 0.03
shader_parameter/rim_thickness = 0.49
shader_parameter/rim_smoothness = 0.1
shader_parameter/side_thickness = 0.6

[sub_resource type="QuadMesh" id="QuadMesh_f4gvo"]
material = SubResource("ShaderMaterial_shj6h")
subdivide_width = 1
subdivide_depth = 8
center_offset = Vector3(0, 0.5, 0)

[node name="GrassField" type="Node3D"]

[node name="GrassFieldMultiMesh" type="MultiMeshInstance3D" parent="."]
multimesh = SubResource("MultiMesh_6hef4")
script = ExtResource("2_qwphb")

[node name="GrassBlade" type="MeshInstance3D" parent="GrassFieldMultiMesh"]
transform = Transform3D(0.999284, -0.0378302, 0, 0.0378302, 0.999284, 0, 0, 0, 1, 1.22008, 6.12254, 3.33337)
cast_shadow = 0
mesh = ExtResource("1_fa7tb")
skeleton = NodePath("../../..")

[node name="GrassBladeDebug" type="MeshInstance3D" parent="GrassFieldMultiMesh/GrassBlade"]
visible = false
cast_shadow = 0
mesh = ExtResource("1_fa7tb")
skeleton = NodePath("../..")
surface_material_override/0 = SubResource("ShaderMaterial_bstpt")

[node name="Plane" type="MeshInstance3D" parent="GrassFieldMultiMesh"]
mesh = SubResource("PlaneMesh_w5gws")

[node name="Floor" type="MeshInstance3D" parent="."]
visible = false
transparency = 1.0
mesh = SubResource("PlaneMesh_an6go")
skeleton = NodePath("../..")

[node name="StaticBody3D" type="StaticBody3D" parent="Floor"]

[node name="CollisionShape3D" type="CollisionShape3D" parent="Floor/StaticBody3D"]
transform = Transform3D(30, 0, 0, 0, 30, 0, 0, 0, 30, 0, 0, 0)
shape = SubResource("ConcavePolygonShape3D_an6go")

[node name="DebugSquare" type="MeshInstance3D" parent="."]
transform = Transform3D(1, 0, 0, 0, -4.37114e-08, -1, 0, 1, -4.37114e-08, 0, 3.42167, 0)
visible = false
mesh = SubResource("QuadMesh_f4gvo")
skeleton = NodePath("../..")

[node name="Ground" type="MeshInstance3D" parent="."]
mesh = SubResource("PlaneMesh_w5gws")
skeleton = NodePath("../GrassFieldMultiMesh/Plane")
